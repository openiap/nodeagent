FROM fedora:36
RUN dnf upgrade -y --refresh \
  && dnf install wget git nano -y \
    chromedriver \
    chromium \
    npm \
    php \
    nodejs \
    python3-pip \
    tzdata \
    xorg-x11-server-Xvfb-${XVFB_VERSION}* \
  && dnf clean all

# fake chrome and force parameters
COPY bin/chromium-browser.sh /tmp/chromium-browser
RUN mv /usr/lib64/chromium-browser/chromium-browser /usr/lib64/chromium-browser/chromium-browser-original \
  && ln -sfv /tmp/chromium-browser /usr/lib64/chromium-browser/chromium-browser
RUN chmod +x /usr/lib64/chromium-browser/chromium-browser
RUN ln -sf /usr/lib64/chromium-browser/chromium-browser /usr/bin/google-chrome

# tagui hack's 
RUN ln -sf /usr/bin/python3 /usr/bin/python
ENV OPENSSL_CONF=/dev/null

# tell puppeteer to skip installing chrome. We'll be using the installed package.
ENV PUPPETEER_SKIP_DOWNLOAD=true

# force loading latest version of nodeagent
RUN npx -y @openiap/nodeagent -noop

CMD ["npx", "@openiap/nodeagent", "-service"]
